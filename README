Original code before refactor and optimization.